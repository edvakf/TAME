# About this repo

This repo is for a reproducibility experiment of the paper "Identifying Sepsis Subphenotypes via Time-Aware Multi-Modal Auto-Encoder".

> **Identifying Sepsis Subphenotypes via Time-Aware Multi-Modal Auto-Encoder (KDD2020)**<br>
> Changchang yin, Ruoqi Liu, Dongdong Zhang, Ping Zhang<br>
> [paper](https://web.cse.ohio-state.edu/~zhang.10631/files/KDD2020_TAME.pdf)

For details, please see the original repo. 
https://github.com/AIMedLab/TAME



# Instruction

## Build pivoted_lab.csv, pivoted_vital.csv and pivoted_sofa.csv

1. Apply for MIMIC-III dataset access on PhysioNet.
1. Make a Google Cloud Platform project for BigQuery.
1. Checkout https://github.com/MIT-LCP/mimic-code.
1. Read mimic-iii/Makefile.md and run `make mimic-download` and `make mimic-gz`. This creates a bunch of *.csv.gz files in `$datadir`.
1. Upload the *.csv.gz to a Google Cloud Storage.
1. Read mimic-iii/buildmimic/bigquery/README.md and follow STEP 6. 
1. Read mimic-iii/concepts/README.md and run make-concept.sh. 
  * You have to modify SQL files under mimic-iii/concepts so that the project name and dataset name are correct.
  * Add demographics/icustay_times.sql and demographics/icustay_hours.sql after demographics/icustay_detail.sql and move demographics/heightweight.sql to after durations/weight_durations.sql.
1. Export pivoted_lab, pivoted_vital and pivoted_sofa to Google Cloud Storage as CSV.

## Preprocessing

Put the CSVs under TAME/data/MIMIC/initial_mimiciii/ and follow the instruction on https://github.com/AIMedLab/TAME#mimic-iii-data-preprocessing.

```
cd code/preprocessing
python preprocess_mimic_data.py --dataset MIMIC
python generate_sepsis_variables.py --dataset MIMIC
python generate_value_distribution.py --dataset MIMIC --split-num 1000
```

This creates a bunch of CSV and JSON files under `file` and `result` directories.

## Training

```
python main.py --dataset DACMI --split-num 1000 --use-mm
```

# Results of TAME

The imputation results on MIMIC-III dataset (all 27 variables).

Results of the reproduction experiment 1 and 2 were added.

* Experiment 1: `--split-num 4000`
* Experiment 2: `--split-num 1000 --use-mm`

```
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Model   |  aniongap  |bicarbonate | creatinine |  chloride  |  glucose   | hemoglobin |  lactate   |  platelet  |    ptt     |    inr     |     pt     |   sodium   |    bun     |    wbc     |    spo2    | C-reactive | heartrate  | hematocrit |   sysbp    |   tempc    |   diasbp   |     gcs    |  resprate  |   bands    |   meanbp   | Magnesium  |urineoutput |    Mean    
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Mean    |    0.29    |    0.24    |    0.25    |    0.22    |    0.30    |    0.27    |    0.42    |    0.27    |    0.46    |    0.32    |    0.41    |    0.24    |    0.23    |    0.26    |    0.32    |    1.37    |    0.40    |    0.31    |    0.31    |    0.38    |    0.32    |    0.37    |    0.31    |    0.86    |    0.22    |    0.42    |    0.34    |    0.37
KNN     |    0.28    |    0.22    |    0.22    |    0.22    |    0.30    |    0.25    |    0.44    |    0.26    |    0.38    |    0.31    |    0.29    |    0.24    |    0.22    |    0.25    |    0.30    |    1.31    |    0.37    |    0.28    |    0.24    |    0.37    |    0.24    |    0.38    |    0.27    |    0.80    |    0.17    |    0.41    |    0.33    |    0.34
3DMICe  |    0.22    |    0.19    |    0.22    |    0.18    |    0.27    |    0.18    |    0.42    |    0.25    |    0.40    |    0.25    |    0.29    |    0.20    |    0.22    |    0.25    |    0.27    |    1.20    |    0.34    |    0.28    |    0.24    |    0.36    |    0.20    |    0.33    |    0.27    |    0.79    |    0.15    |    0.38    |    0.30    |    0.32
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
BRNN    |    0.15    |    0.17    |    0.20    |    0.13    |    0.29    |    0.12    |    0.40    |    0.20    |    0.41    |    0.16    |    0.24    |    0.18    |    0.17    |    0.26    |    0.25    |    1.28    |    0.31    |    0.25    |    0.18    |    0.26    |    0.17    |    0.23    |    0.24    |    0.96    |    0.13    |    0.36    |    0.27    |    0.30
CATSI   |    0.12    |    0.12    |    0.22    |    0.13    |    0.29    |    0.14    |    0.41    |    0.22    |    0.42    |    0.20    |    0.25    |    0.18    |    0.20    |    0.23    |    0.25    |    1.13    |    0.34    |    0.25    |    0.18    |    0.24    |    0.16    |    0.22    |    0.24    |    0.85    |    0.13    |    0.33    |    0.27    |    0.29
DETROIT |    0.11    |    0.09    |    0.28    |    0.09    |    0.27    |    0.13    |    0.38    |    0.22    |    0.46    |    0.17    |    0.24    |    0.10    |    0.17    |    0.22    |    0.26    |    1.10    |    0.31    |    0.26    |    0.18    |    0.24    |    0.16    |    0.23    |    0.24    |    0.78    |    0.13    |    0.33    |    0.25    |    0.27
BRITS   |    0.12    |    0.08    |    0.23    |    0.12    |    0.27    |    0.12    |    0.39    |    0.20    |    0.41    |    0.18    |    0.24    |    0.16    |    0.20    |    0.20    |    0.26    |    1.22    |    0.32    |    0.23    |    0.19    |    0.23    |    0.15    |    0.20    |    0.24    |    0.84    |    0.13    |    0.34    |    0.26    |    0.28
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
TAME-T  |    0.13    |    0.11    |    0.24    |    0.10    |    0.25    |    0.11    |    0.34    |    0.19    |    0.36    |    0.21    |    0.24    |    0.11    |    0.17    |    0.20    |    0.24    |    1.29    |    0.24    |    0.17    |    0.15    |    0.25    |    0.13    |    0.16    |    0.23    |    0.71    |    0.12    |    0.30    |    0.24    |    0.26
TAME-V  |    0.16    |    0.13    |    0.23    |    0.12    |    0.26    |    0.11    |    0.36    |    0.20    |    0.38    |    0.19    |    0.22    |    0.14    |    0.17    |    0.20    |    0.23    |    1.29    |    0.23    |    0.18    |    0.13    |    0.21    |    0.12    |    0.15    |    0.22    |    0.70    |    0.11    |    0.31    |    0.24    |    0.26
TAME-M  |    0.13    |    0.11    |    0.24    |    0.10    |    0.25    |    0.11    |    0.34    |    0.19    |    0.36    |    0.21    |    0.24    |    0.11    |    0.17    |    0.23    |    0.24    |    1.33    |    0.24    |    0.20    |    0.14    |    0.25    |    0.14    |    0.16    |    0.24    |    0.73    |    0.14    |    0.32    |    0.25    |    0.27
TAME    |    0.11    |    0.09    |    0.19    |    0.08    |    0.26    |    0.09    |    0.35    |    0.18    |    0.38    |    0.15    |    0.20    |    0.10    |    0.14    |    0.21    |    0.22    |    1.16    |    0.23    |    0.19    |    0.13    |    0.24    |    0.12    |    0.16    |    0.20    |    0.73    |    0.12    |    0.31    |    0.23    |    0.25
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Exp 1   |    0.26    |    0.22    |    0.35    |    0.19    |    0.22    |    0.18    |    0.44    |    0.28    |    0.71    |    0.41    |    0.51    |    0.26    |    0.28    |    0.31    |    0.23    |    1.43    |    0.19    |    0.18    |    0.13    |    0.22    |    0.10    |    0.23    |    0.22    |    0.85    |    0.09    |    0.34    |    0.22    |    0.28
Exp 2   |    0.23    |    0.19    |    0.39    |    0.17    |    0.24    |    0.15    |    0.48    |    0.32    |    0.63    |    0.40    |    0.46    |    0.25    |    0.31    |    0.32    |    0.23    |    1.32    |    0.20    |    0.18    |    0.12    |    0.24    |    0.09    |    0.20    |    0.23    |    0.83    |    0.08    |    0.36    |    0.25    |    0.27
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
```
